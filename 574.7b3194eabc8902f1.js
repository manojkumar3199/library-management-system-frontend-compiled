"use strict";(self.webpackChunklibrary_management_system=self.webpackChunklibrary_management_system||[]).push([[574],{4574:(O,h,n)=>{n.r(h),n.d(h,{IssuebookListModule:()=>l});var k=n(6895),b=n(9299),m=n(6308),r=n(7155),t=n(4650),L=n(8541),y=n(2882),g=n(7009),C=n(5412),I=n(7392),Z=n(4859),f=n(9549),x=n(4144),v=n(266);function _(o,e){if(1&o&&(t.TgZ(0,"div",17)(1,"strong"),t._uU(2,"Error: "),t.qZA(),t._uU(3),t.qZA()),2&o){const s=t.oxw();t.xp6(3),t.AsE("",null==s.error.error?null:s.error.error.error," ",null==s.error.error?null:s.error.error.message,"\n")}}function A(o,e){1&o&&(t.TgZ(0,"th",18),t._uU(1,"Issue Id"),t.qZA())}function D(o,e){if(1&o&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&o){const s=e.$implicit;t.xp6(1),t.hij(" ",s.id," ")}}function Y(o,e){1&o&&(t.TgZ(0,"th",18),t._uU(1,"Student"),t.qZA())}function U(o,e){if(1&o&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&o){const s=e.$implicit;t.xp6(1),t.hij(" ",s.student.name," ")}}function N(o,e){1&o&&(t.TgZ(0,"th",18),t._uU(1,"Book"),t.qZA())}function S(o,e){if(1&o&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&o){const s=e.$implicit;t.xp6(1),t.hij(" ",s.book.title," ")}}function w(o,e){1&o&&(t.TgZ(0,"th",18),t._uU(1,"Issue Date"),t.qZA())}function Q(o,e){if(1&o&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&o){const s=e.$implicit;t.xp6(1),t.hij(" ",s.issueDate," ")}}function R(o,e){1&o&&(t.TgZ(0,"th",18),t._uU(1,"Expiring Date"),t.qZA())}function j(o,e){if(1&o&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&o){const s=e.$implicit;t.xp6(1),t.hij(" ",s.expiringDate," ")}}function J(o,e){1&o&&(t.TgZ(0,"th",20),t._uU(1,"Action"),t.qZA())}function M(o,e){if(1&o){const s=t.EpF();t.TgZ(0,"td",19)(1,"button",21),t.NdJ("click",function(){const a=t.CHM(s).$implicit,T=t.oxw();return t.KtG(T.returnBook(a))}),t.TgZ(2,"mat-icon"),t._uU(3,"restart_alt"),t.qZA()()()}}function E(o,e){1&o&&t._UZ(0,"tr",22)}function F(o,e){1&o&&t._UZ(0,"tr",23)}class d{constructor(e,s,i,u,a){this.issuebookService=e,this.storeService=s,this.cdRef=i,this._snackBar=u,this._dialog=a,this.issuedBooks=new r.by,this.error=null,this.displayedColumns=["id","student","book","issueDate","expiringDate","action"]}ngOnInit(){this.storeService.issuedBooksLoaded||this.issuebookService.getAllIssuedBooks().subscribe({next:e=>{this.storeService.loadIssuedBooks(e)},error:e=>{console.log(e),this.error=e}}),this.storeService.currentIssuedBooks$.subscribe(e=>this.issuedBooks.data=e)}ngAfterViewInit(){this.issuedBooks.sortingDataAccessor=(e,s)=>{switch(s){case"student":return e.student.name;case"book":return e.book.title;default:return e[s]}},this.issuedBooks.sort=this.sort,console.log(this.sort),this.cdRef.detectChanges()}applyFilter(e){const s=e.target.value;this.issuedBooks.filterPredicate=(i,u)=>-1!==Object.keys(i).reduce((p,B)=>{switch(B){case"student":return p+i.student.name;case"book":return p+i.book.title;default:return p+i[B]}},"").toLowerCase().indexOf(u),this.issuedBooks.filter=s.trim().toLowerCase()}returnBook(e){this.issuebookService.returnBook(e.student.id,e.book.id).subscribe({next:u=>{this.storeService.removeIssuedBook(e.id);let a=e.book;a.reserved=!1,this.storeService.modifyBook(a),this.storeService.decrementIssuedBook(),this._snackBar.open("Book Returned successfully!","",{duration:3e3})},error:u=>this.error=u})}}d.\u0275fac=function(e){return new(e||d)(t.Y36(L.C),t.Y36(y.d),t.Y36(t.sBO),t.Y36(g.ux),t.Y36(C.uw))},d.\u0275cmp=t.Xpm({type:d,selectors:[["app-issuebook-list"]],viewQuery:function(e,s){if(1&e&&t.Gf(m.YE,5),2&e){let i;t.iGM(i=t.CRH())&&(s.sort=i.first)}},decls:32,vars:4,consts:[[1,"container","mt-3","p-3","bg-white"],[1,"fs-4","fw-bold"],["class","container mt-3 alert alert-danger",4,"ngIf"],[1,"container","mt-3","pt-3","px-3","d-flex","flex-column","bg-white"],["matInput","",3,"keyup"],["mat-table","","matSort","",1,"text-center",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","student"],["matColumnDef","book"],["matColumnDef","issueDate"],["matColumnDef","expiringDate"],["matColumnDef","action"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"container","mt-3","alert","alert-danger"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","matTooltip","Return Book",1,"text-success",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"p",1),t._uU(2,"List Of Issued Books"),t.qZA(),t._UZ(3,"hr"),t.qZA(),t.YNc(4,_,4,2,"div",2),t.TgZ(5,"div",3)(6,"mat-form-field")(7,"mat-label"),t._uU(8,"Filter Issued Book"),t.qZA(),t.TgZ(9,"input",4),t.NdJ("keyup",function(u){return s.applyFilter(u)}),t.qZA()()(),t.TgZ(10,"div",0)(11,"table",5),t.ynx(12,6),t.YNc(13,A,2,0,"th",7),t.YNc(14,D,2,1,"td",8),t.BQk(),t.ynx(15,9),t.YNc(16,Y,2,0,"th",7),t.YNc(17,U,2,1,"td",8),t.BQk(),t.ynx(18,10),t.YNc(19,N,2,0,"th",7),t.YNc(20,S,2,1,"td",8),t.BQk(),t.ynx(21,11),t.YNc(22,w,2,0,"th",7),t.YNc(23,Q,2,1,"td",8),t.BQk(),t.ynx(24,12),t.YNc(25,R,2,0,"th",7),t.YNc(26,j,2,1,"td",8),t.BQk(),t.ynx(27,13),t.YNc(28,J,2,0,"th",14),t.YNc(29,M,4,0,"td",8),t.BQk(),t.YNc(30,E,1,0,"tr",15),t.YNc(31,F,1,0,"tr",16),t.qZA()()),2&e&&(t.xp6(4),t.Q6J("ngIf",s.error),t.xp6(7),t.Q6J("dataSource",s.issuedBooks),t.xp6(19),t.Q6J("matHeaderRowDef",s.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",s.displayedColumns))},dependencies:[k.O5,r.BZ,r.fO,r.as,r.w1,r.Dz,r.nj,r.ge,r.ev,r.XQ,r.Gk,I.Hw,Z.RK,f.KE,f.hX,x.Nt,m.YE,m.nU,v.gM]});const H=[{path:"",component:d}];class c{}c.\u0275fac=function(e){return new(e||c)},c.\u0275mod=t.oAB({type:c}),c.\u0275inj=t.cJS({imports:[b.Bz.forChild(H),b.Bz]});class l{}l.\u0275fac=function(e){return new(e||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[k.ez,c,r.p0,I.Ps,Z.ot,f.lN,x.c,g.ZX,C.Is,m.JX,v.AV]})}}]);